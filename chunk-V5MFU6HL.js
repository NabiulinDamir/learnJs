import{a as B}from"./chunk-J7HVS52F.js";import{$a as b,Aa as h,Ob as g,Qa as D,Ra as I,Ub as k,Vb as F,Wb as V,Xa as w,Ya as T,Za as _,_a as x,ab as E,cb as O,da as d,ia as M,kb as A,lb as P,qa as C,ra as y,rb as f,wa as u,yb as S,zb as L}from"./chunk-4OZAX3O6.js";function J(l,o){l&1&&(x(0,"div",2),P(1," \u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 "),b())}var v=class l{constructor(o,t,n,r,i){this.localStorage=o;this.datePipe=t;this.element=n;this.filter=r;this.theme=i;L(()=>{if(!this._isVisible())return;let s=document.getElementById("chart-container");s?.removeAttribute("_echarts_instance_"),!(!s||s.clientWidth===0)&&(this._chart=B(s,i.darkTheme()?"dark":""),this._chart.setOption(this.option()))})}_chart=void 0;observer;_isVisible=d(!1);option=S(()=>{let o=this.formatToMonth(this.localStorage.getOperationsByType("income")),t=this.formatToMonth(this.localStorage.getOperationsByType("expens")),n=this.formatToCategory(this.localStorage.getOperationsByType("income")),r=this.formatToCategory(this.localStorage.getOperationsByType("expens")),i=o.map(e=>e.value).sort((e,a)=>e-a),s=t.map(e=>e.value).sort((e,a)=>e-a),c=o.sort((e,a)=>e.value-a.value).map(e=>e.name),m=t.sort((e,a)=>e.value-a.value).map(e=>e.name),p=Math.max(...i.concat(s)),z=i?i.reduce((e,a)=>a+e):0,j=s?s.reduce((e,a)=>a+e):0,R=i.map(e=>p-e),H=s.map(e=>p-e),W=n.length?n.reduce((e,a)=>a.value>e.value?a:e).name:"...",Y=r.length?r.reduce((e,a)=>a.value>e.value?a:e).name:"...";return{backgroundColor:"transparent",tooltip:{},title:[{text:"\u0414\u043E\u0445\u043E\u0434\u044B",subtext:"\u0421\u0443\u043C\u043C\u0430\u0440\u043D\u043E: "+z,left:"25%",textAlign:"center"},{text:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u0434\u043E\u0445\u043E\u0434\u043E\u0432",subtext:"\u0411\u043E\u043B\u044C\u0448\u0435 \u0432\u0441\u0435\u0433\u043E \u0434\u043E\u0445\u043E\u0434\u043E\u0432: "+W,left:"75%",textAlign:"center"},{text:"\u0420\u0430\u0441\u0445\u043E\u0434\u044B",subtext:"\u0421\u0443\u043C\u043C\u0430\u0440\u043D\u043E: "+j,left:"25%",top:"50%",textAlign:"center"},{text:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u0440\u0430\u0441\u0445\u043E\u0434\u043E\u0432",subtext:"\u0411\u043E\u043B\u044C\u0448\u0435 \u0432\u0441\u0435\u0433\u043E \u0442\u0440\u0430\u0442: "+Y,left:"75%",top:"50%",textAlign:"center"}],grid:[{top:"8%",width:"50%",bottom:"50%",left:10,containLabel:!0},{top:"56%",width:"50%",bottom:0,left:10,containLabel:!0}],xAxis:[{type:"value",max:p,splitLine:{show:!1}},{type:"value",max:p,gridIndex:1,splitLine:{show:!1}}],yAxis:[{type:"category",data:c,axisLabel:{interval:0,rotate:30},splitLine:{show:!1}},{gridIndex:1,type:"category",data:m,axisLabel:{interval:0,rotate:30},splitLine:{show:!1}}],series:[{type:"bar",stack:"chart",z:3,label:{position:"right",show:!0},data:i},{type:"bar",stack:"chart",silent:!0,itemStyle:{color:this.theme.darkTheme()?"#353232ee":"#eeee"},data:R},{type:"bar",stack:"component",xAxisIndex:1,yAxisIndex:1,z:3,label:{position:"right",show:!0},data:s},{type:"bar",stack:"component",silent:!0,xAxisIndex:1,yAxisIndex:1,itemStyle:{color:this.theme.darkTheme()?"#353232ee":"#eeee"},data:H},{type:"pie",radius:[0,"30%"],center:["75%","25%"],data:n},{type:"pie",radius:[0,"30%"],center:["75%","75%"],data:r}]}});formatToMonth(o){let t=o.sort((c,m)=>c.date.getTime()-m.date.getTime()),n=new Map,r=new Date(this.filter.startYearInteval),i=new Date(this.filter.endYearInteval);do{let c=this.datePipe.transform(r,"MMMM");n.set(c,{name:c,value:0}),r.setMonth(r.getMonth()+1)}while(r<=i);for(let c of t){let m=this.datePipe.transform(c.date,"MMMM"),p=n.get(m);n.set(m,{name:m,value:p.value+c.value})}return Array.from(n.values())}formatToCategory(o){let t=new Map;return o.forEach(r=>{let i=r.category;t.has(i)||t.set(i,{name:i,value:0});let s=t.get(i).value;t.set(i,{name:i,value:s+r.value})}),Array.from(t.values())}ngAfterViewInit(){this.observer=new IntersectionObserver(([o])=>{this._isVisible.set(o.isIntersecting)}),this.observer.observe(this.element.nativeElement)}ngOnDestroy(){this._chart?.dispose(),this.observer?.disconnect()}onWindowResize(){this._chart&&this._chart.resize()}get hasData(){return this.localStorage.allOperations().length>0}static \u0275fac=function(t){return new(t||l)(u(V),u(g),u(M),u(F),u(k))};static \u0275cmp=h({type:l,selectors:[["my-chart-mega"]],hostBindings:function(t,n){t&1&&O("resize",function(){return n.onWindowResize()},C)},features:[f([g])],decls:3,vars:3,consts:[[1,"position-relative","d-flex","justify-content-around","h-25rem"],["id","chart-container",1,"w-100",2,"height","800px","max-width","100vw"],[1,"position-absolute","top-0","left-0","w-100","h-100","z-3","d-flex","justify-content-center","align-items-center"]],template:function(t,n){t&1&&(x(0,"div",0),E(1,"div",1),D(2,J,2,0,"div",2),b()),t&2&&(y(),A("opacity-50",!n.hasData),y(),I(n.hasData?-1:2))},encapsulation:2})};var N=class l{title=d("fms-angular-app");constructor(){}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=h({type:l,selectors:[["my-app-main-page"]],features:[f([])],decls:2,vars:0,consts:[[1,"h-100","w-100"]],template:function(t,n){t&1&&(w(0,"div",0),_(1,"my-chart-mega"),T())},dependencies:[v],encapsulation:2})};export{N as ChartsPage};
