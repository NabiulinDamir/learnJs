{
  "version": 3,
  "sources": ["src/app/components/Components_Chart/charts/ChartDataset/chartDataset.component.ts", "src/app/components/Components_Chart/charts/ChartDataset/chartDataset.html"],
  "sourcesContent": ["import { Component, OnDestroy, HostListener, effect } from '@angular/core';\nimport * as echarts from 'echarts';\nimport { LocalStorage } from '../../../../servises/LocalStorage.service';\nimport { DatePipe } from '@angular/common';\nimport { Filter } from '../../../../servises/filter.service';\nimport { IOperation } from '../../../../models/dataTypes.model';\nimport { Theme } from '../../../../servises/theme.service';\n@Component({\n  selector: 'my-chart-dataset',\n  providers: [DatePipe],\n  templateUrl: './chartDataset.html',\n})\nexport class ChartDataset implements OnDestroy {\n  private _chart: echarts.ECharts | undefined = undefined;\n  private _option: any | undefined = undefined;\n  constructor(\n    private localStorage: LocalStorage,\n    private datePipe: DatePipe,\n    public filter: Filter,\n    public theme: Theme\n  ) {\n    effect(() => {\n      this.updateOption();\n      this.setOption();\n    });\n    effect(() => {\n      this.init();\n      this.setOption();\n    })\n  }\n\n  public setOption(): void {\n    if(this._option) { this._chart?.setOption(this._option) }\n  }\n\n  public init(): void {\n    const theme = this.theme.darkTheme() ? 'dark' : '';\n    const chartDom = document.getElementById('chart-container');\n    if(!chartDom?.clientHeight){ return };\n    this._chart?.dispose();\n    this._chart = echarts.init(chartDom, theme);\n    this._chart.off('click');\n    this._chart.on('click', (params: any) => {\n      this.clickToChart(params);\n    });\n  }\n\n  updateOption(){\n    const data = this.localStorage.filter(this.localStorage.allOperations());\n    const formattedData = this.format(data)\n    const intervalLocaleRu = this.filter.intervalLocale()\n    this._option = {\n      backgroundColor: 'transparent',\n      tooltip: { trigger: 'axis' },\n      legend: {\n        data: ['Доходы', 'Расходы'],\n        itemGap: 5,\n      },\n      title: {\n        text: `Операции за ${intervalLocaleRu}`,\n        position: 'top',\n      },\n      dataset: {\n        source: formattedData,\n      },\n      grid: {\n        top: '12%',\n        left: '1%',\n        right: '10%',\n        containLabel: true,\n      },\n      xAxis: {\n        type: 'category',\n      },\n      yAxis: {\n        type: 'value',\n        name: 'Сумма',\n      },\n      dataZoom: [\n        {\n          show: true,\n          start: 0,\n          end: 100,\n        },\n      ],\n      series: [\n        {\n          name: 'Доходы',\n          type: 'bar',\n          color: '#0d6efd',\n        },\n        {\n          name: 'Расходы',\n          type: 'bar',\n          color: '#6c757d',\n        },\n      ],\n    };\n  };\n\n  format(data: IOperation[]): { name: string; income: number; expens: number; date: Date }[] {\n    const allOperations = data.sort((a, b) => a.date.getTime() - b.date.getTime());\n    const resultMap = new Map();\n\n    let currentDate = new Date(this.filter.startInterval());\n    let endDate = new Date(this.filter.endInterval());\n\n    do {\n      const key = this.formatDate(currentDate);\n      resultMap.set(key, { name: key, income: 0, expens: 0 });\n      if (this.filter.interval() === 'day') {\n        currentDate.setHours(currentDate.getHours() + 1);\n      } else if (this.filter.interval() === 'month') {\n        currentDate.setDate(currentDate.getDate() + 1);\n      } else if (this.filter.interval() === 'year') {\n        currentDate.setMonth(currentDate.getMonth() + 1);\n      } else {\n        currentDate.setDate(currentDate.getDate() + 1);\n      }\n    } while (currentDate <= endDate);\n\n    for (const operation of allOperations) {\n      const key = this.formatDate(operation.date);\n      const mapElemet = resultMap.get(key);\n      const incomeValue = operation.type === 'income' ? operation.value : 0;\n      const expensValue = operation.type === 'expens' ? operation.value : 0;\n      if (!mapElemet) {\n        resultMap.set(key, {\n          name: key,\n          income: incomeValue,\n          expens: expensValue,\n          date: operation.date,\n        });\n      } else {\n        resultMap.set(key, {\n          name: key,\n          income: mapElemet.income + incomeValue,\n          expens: mapElemet.expens + expensValue,\n          date: operation.date,\n        });\n      }\n    }\n    const res = Array.from(resultMap.values());\n    return res;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////\n\n  clickToChart(params: any): void {\n    if (params.componentType === 'series') {\n      this.filter.downInterval();\n      setTimeout(() => this.filter.setDate(params.data.date), 100);\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////\n\n  formatDate(date: Date): string | null {\n    const pattern = () => {\n      switch (this.filter.interval()) {\n        case 'day':\n          return 'H';\n        case 'month':\n          return 'd';\n        case 'year':\n          return 'MMMM';\n        default:\n          return 'dd.MM.yyyy';\n      }\n    };\n    return this.datePipe.transform(date, pattern());\n  }\n\n  ngAfterViewInit() {\n    this.init();\n    this.setOption();\n  }\n\n  ngOnDestroy() {\n    this._chart?.dispose();\n  }\n\n  @HostListener('window:resize')\n  onWindowResize() {\n    if (this._chart) {\n      this._chart.resize();\n    }\n  }\n\n  get hasData(): boolean {\n    return this.localStorage.filter(this.localStorage.allOperations()).length > 0;\n  }\n}\n", "<div class=\"position-relative w-100 d-flex justify-content-around h-100 \">\n  <div\n    id=\"chart-container\"\n    [class.opacity-50]=\"!hasData\"\n    style=\"width: 70rem; max-width: 100vw;\"\n  ></div>\n  @if(!hasData){\n  <div\n    class=\"position-absolute top-0 left-0 w-100 h-100 z-3 d-flex justify-content-center align-items-center\"\n  >\n    Нет данных\n  </div>\n  }\n</div>"],
  "mappings": "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",
  "names": []
}
