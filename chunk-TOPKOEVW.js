import{a as F}from"./chunk-PQMMYDSJ.js";import{$a as _,Aa as d,Nb as f,Pa as w,Qa as D,Tb as S,Ub as L,Vb as k,Wa as I,Xa as T,Ya as O,Za as y,_a as x,bb as E,da as C,kb as P,lb as A,qa as b,ra as v,rb as u,wa as h,zb as M}from"./chunk-AXCKFBAQ.js";function J(c,o){c&1&&(y(0,"div",2),A(1," \u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 "),x())}var g=class c{constructor(o,e,a,n){this.localStorage=o;this.datePipe=e;this.filter=a;this.theme=n;M(()=>{this.updateOption(),this.setOption()}),M(()=>{this.init(),this.setOption()})}_chart=void 0;_option=void 0;setOption(){this._chart?.setOption(this._option)}init(){let o=this.theme.darkTheme()?"dark":"",e=document.getElementById("chart-container");this._chart?.dispose(),e?.clientHeight!==0&&(this._chart=F(e,o))}updateOption(){let o=this.formatToMonth(this.localStorage.getOperationsByType("income")),e=this.formatToMonth(this.localStorage.getOperationsByType("expens")),a=this.formatToCategory(this.localStorage.getOperationsByType("income")),n=this.formatToCategory(this.localStorage.getOperationsByType("expens")),r=[...o].sort((t,m)=>t.value-m.value),p=[...e].sort((t,m)=>t.value-m.value),i=r.map(t=>t.value),s=p.map(t=>t.value),l=Math.max(...i,...s),N=i.reduce((t,m)=>t+m,0),z=s.reduce((t,m)=>t+m,0),j=r.map(t=>t.name),V=p.map(t=>t.name),H=i.map(t=>l-t),W=s.map(t=>l-t),R=a[0]?.name||"...",Y=n[0]?.name||"...";this._option={backgroundColor:"transparent",tooltip:{},title:[{text:"\u0414\u043E\u0445\u043E\u0434\u044B",subtext:"\u0421\u0443\u043C\u043C\u0430\u0440\u043D\u043E: "+N,left:"25%",textAlign:"center"},{text:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u0434\u043E\u0445\u043E\u0434\u043E\u0432",subtext:"\u0411\u043E\u043B\u044C\u0448\u0435 \u0432\u0441\u0435\u0433\u043E \u0434\u043E\u0445\u043E\u0434\u043E\u0432: "+R,left:"75%",textAlign:"center"},{text:"\u0420\u0430\u0441\u0445\u043E\u0434\u044B",subtext:"\u0421\u0443\u043C\u043C\u0430\u0440\u043D\u043E: "+z,left:"25%",top:"50%",textAlign:"center"},{text:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438 \u0440\u0430\u0441\u0445\u043E\u0434\u043E\u0432",subtext:"\u0411\u043E\u043B\u044C\u0448\u0435 \u0432\u0441\u0435\u0433\u043E \u0442\u0440\u0430\u0442: "+Y,left:"75%",top:"50%",textAlign:"center"}],grid:[{top:"8%",width:"50%",bottom:"50%",left:10,containLabel:!0},{top:"56%",width:"50%",bottom:0,left:10,containLabel:!0}],xAxis:[{type:"value",max:l,splitLine:{show:!1}},{type:"value",max:l,gridIndex:1,splitLine:{show:!1}}],yAxis:[{type:"category",data:j,axisLabel:{interval:0,rotate:30},splitLine:{show:!1}},{gridIndex:1,type:"category",data:V,axisLabel:{interval:0,rotate:30},splitLine:{show:!1}}],series:[{type:"bar",stack:"chart",z:3,label:{position:"right",show:!0},data:i},{type:"bar",stack:"chart",silent:!0,itemStyle:{color:this.theme.darkTheme()?"#353232ee":"#eeee"},data:H},{type:"bar",stack:"component",xAxisIndex:1,yAxisIndex:1,z:3,label:{position:"right",show:!0},data:s},{type:"bar",stack:"component",silent:!0,xAxisIndex:1,yAxisIndex:1,itemStyle:{color:this.theme.darkTheme()?"#353232ee":"#eeee"},data:W},{type:"pie",radius:[0,"30%"],center:["75%","25%"],data:a},{type:"pie",radius:[0,"30%"],center:["75%","75%"],data:n}]}}formatToMonth(o){let e=o.sort((i,s)=>i.date.getTime()-s.date.getTime()),a=new Map,n=new Date(this.filter.startYearInteval()),r=new Date(this.filter.endYearInteval());do{let i=this.datePipe.transform(isNaN(n.getTime())?new Date:n,"MMMM");a.set(i,{name:i,value:0}),n.setMonth(n.getMonth()+1)}while(n<=r);for(let i of e){let s=this.datePipe.transform(i.date,"MMMM"),l=a.get(s);a.set(s,{name:s,value:l.value+i.value})}return Array.from(a.values())}formatToCategory(o){let e=new Map;return o.forEach(n=>{let r=n.category;e.has(r)||e.set(r,{name:r,value:0});let p=e.get(r).value;e.set(r,{name:r,value:p+n.value})}),Array.from(e.values())}ngAfterViewInit(){this.init(),this.setOption()}ngOnDestroy(){this._chart?.dispose()}onWindowResize(){this._chart&&this._chart.resize()}get hasData(){return this.localStorage.allOperations().length>0}static \u0275fac=function(e){return new(e||c)(h(k),h(f),h(L),h(S))};static \u0275cmp=d({type:c,selectors:[["my-chart-mega"]],hostBindings:function(e,a){e&1&&E("resize",function(){return a.onWindowResize()},b)},features:[u([f])],decls:3,vars:3,consts:[[1,"position-relative","d-flex","justify-content-around","h-25rem"],["id","chart-container",1,"w-100",2,"height","800px","max-width","100vw"],[1,"position-absolute","top-0","left-0","w-100","h-100","z-3","d-flex","justify-content-center","align-items-center"]],template:function(e,a){e&1&&(y(0,"div",0),_(1,"div",1),w(2,J,2,0,"div",2),x()),e&2&&(v(),P("opacity-50",!a.hasData),v(),D(a.hasData?-1:2))},encapsulation:2})};var B=class c{title=C("fms-angular-app");constructor(){}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=d({type:c,selectors:[["my-app-main-page"]],features:[u([])],decls:2,vars:0,consts:[[1,"h-100","w-100"]],template:function(e,a){e&1&&(I(0,"div",0),O(1,"my-chart-mega"),T())},dependencies:[g],encapsulation:2})};export{B as ChartsPage};
