import{a as l}from"./chunk-RXRIHWC5.js";import{$a as y,Aa as f,Nb as d,Pa as g,Qa as v,Tb as w,Ub as x,Vb as D,Za as c,_a as p,bb as C,kb as h,lb as O,qa as u,ra as s,rb as _,wa as r,zb as m}from"./chunk-C6LQUR5L.js";function I(a,t){a&1&&(c(0,"div",3),O(1," \u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 "),p())}var T=class a{constructor(t,e,i,o){this.localStorage=t;this.datePipe=e;this.filter=i;this.theme=o;m(()=>{this.updateIncomeOption(),this.updateExpensOption(),this.setOption()}),m(()=>{this.init(),this.setOption()})}_incomeChart=void 0;_expensChart=void 0;_incomeOption=void 0;_expensOption=void 0;setOption(){this._incomeChart?.setOption(this._incomeOption),this._expensChart?.setOption(this._expensOption)}init(){let t=this.theme.darkTheme()?"dark":"",e=document.getElementById("my-chart-rounded-income"),i=document.getElementById("my-chart-rounded-expens");!e?.clientHeight||!i?.clientHeight||(this._incomeChart?.dispose(),this._expensChart?.dispose(),this._incomeChart=l(e,t),this._expensChart=l(i,t))}updateIncomeOption(){let t=this.localStorage.filter(this.localStorage.getOperationsByType("income"));this._incomeOption=this.getOption(t,"\u0414\u043E\u0445\u043E\u0434\u044B")}updateExpensOption(){let t=this.localStorage.filter(this.localStorage.getOperationsByType("expens"));this._expensOption=this.getOption(t,"\u0414\u043E\u0445\u043E\u0434\u044B")}getOption(t,e){let i=this.format(t);return{backgroundColor:"transparent",tooltip:{trigger:"item"},title:{text:`${e}: ${t.reduce((o,n)=>o+=n.value,0)} \u0440\u0443\u0431.`,position:"top"},series:[{name:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F",type:"pie",radius:["40%","70%"],data:i,top:"10%",label:{show:!0,position:"outside"},color:["#0d6efd","#0a58ca","#3d8bfd","#6ea8fe","#9fcdff","#084298","#052c65"]}]}}format(t){let e=new Map;return t.forEach(o=>{let n=o.category;e.has(n)||e.set(n,{name:n,value:0});let E=e.get(n).value;e.set(n,{name:n,value:E+o.value})}),Array.from(e.values())}formatDate(t){let e=()=>{switch(this.filter.interval()){case"day":return"H";case"month":return"d";case"year":return"MMMM";default:return"dd.MM.yyyy"}};return this.datePipe.transform(t,e())}ngAfterViewInit(){this.init(),this.setOption()}ngOnDestroy(){this._incomeChart?.dispose(),this._expensChart?.dispose()}onWindowResize(){this._incomeChart&&this._incomeChart.resize(),this._expensChart&&this._expensChart.resize()}get hasData(){return this.localStorage.filter(this.localStorage.allOperations()).length>0}static \u0275fac=function(e){return new(e||a)(r(D),r(d),r(x),r(w))};static \u0275cmp=f({type:a,selectors:[["my-chart-two-rounded"]],hostBindings:function(e,i){e&1&&C("resize",function(){return i.onWindowResize()},u)},features:[_([d])],decls:4,vars:5,consts:[[1,"position-relative","h-100","w-100","d-flex","justify-content-around"],["id","my-chart-rounded-income",2,"width","30rem","max-width","40vw"],["id","my-chart-rounded-expens",2,"width","30rem","max-width","40vw"],[1,"position-absolute","top-0","left-0","w-100","h-100","z-3","d-flex","justify-content-center","align-items-center"]],template:function(e,i){e&1&&(c(0,"div",0),y(1,"div",1)(2,"div",2),g(3,I,2,0,"div",3),p()),e&2&&(s(),h("opacity-50",!i.hasData),s(),h("opacity-50",!i.hasData),s(),v(i.hasData?-1:3))},encapsulation:2})};export{T as ChartTwoRounded};
