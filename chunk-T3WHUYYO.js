import{a as k}from"./chunk-J7HVS52F.js";import{$a as p,Aa as y,Ob as c,Qa as b,Ra as _,Ub as M,Vb as T,Wb as S,_a as d,ab as C,cb as w,da as v,ia as g,kb as x,lb as O,qa as D,ra as m,rb as I,wa as o,zb as E}from"./chunk-4OZAX3O6.js";function j(s,e){s&1&&(d(0,"div",2),O(1," \u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 "),p())}var P=class s{constructor(e,t,r,i,h){this.localStorage=e;this.datePipe=t;this.element=r;this.filter=i;this.theme=h;E(()=>{this.setOption()})}_chart=void 0;observer;_isVisible=v(!1);setOption(){let e=this.getOption(this.localStorage.filter(this.localStorage.allOperations()));this._chart?.setOption(e)}init(){let e=document.getElementById("chart-container");e?.removeAttribute("_echarts_instance_"),this._chart=k(e,this.theme.darkTheme()?"dark":""),this._chart.off("click"),this._chart.on("click",t=>{this.clickToChart(t)}),this.setOption()}getOption(e){let t=this.format(e);return{backgroundColor:"transparent",tooltip:{trigger:"axis"},legend:{data:["\u0414\u043E\u0445\u043E\u0434\u044B","\u0420\u0430\u0441\u0445\u043E\u0434\u044B"],itemGap:5},title:{text:`\u041E\u043F\u0435\u0440\u0430\u0446\u0438\u0438 \u0437\u0430 ${this.filter.intervalLocale}`,position:"top"},dataset:{source:t},grid:{top:"12%",left:"1%",right:"10%",containLabel:!0},xAxis:{type:"category"},yAxis:{type:"value",name:"\u0421\u0443\u043C\u043C\u0430"},dataZoom:[{show:!0,start:0,end:100}],series:[{name:"\u0414\u043E\u0445\u043E\u0434\u044B",type:"bar",color:"#0d6efd"},{name:"\u0420\u0430\u0441\u0445\u043E\u0434\u044B",type:"bar",color:"#6c757d"}]}}format(e){let t=e.sort((a,n)=>a.date.getTime()-n.date.getTime()),r=new Map,i=new Date(this.filter.startInterval),h=new Date(this.filter.endInterval);do{let a=this.formatDate(i);r.set(a,{name:a,income:0,expens:0}),this.filter.interval()==="day"?i.setHours(i.getHours()+1):this.filter.interval()==="month"?i.setDate(i.getDate()+1):this.filter.interval()==="year"?i.setMonth(i.getMonth()+1):i.setDate(i.getDate()+1)}while(i<=h);for(let a of t){let n=this.formatDate(a.date),l=r.get(n),f=a.type==="income"?a.value:0,u=a.type==="expens"?a.value:0;l?r.set(n,{name:n,income:l.income+f,expens:l.expens+u,date:a.date}):r.set(n,{name:n,income:f,expens:u,date:a.date})}return Array.from(r.values())}clickToChart(e){e.componentType==="series"&&(this.filter.downInterval(),setTimeout(()=>this.filter.setDate(e.data.date),100))}formatDate(e){let t=()=>{switch(this.filter.interval()){case"day":return"H";case"month":return"d";case"year":return"MMMM";default:return"dd.MM.yyyy"}};return this.datePipe.transform(e,t())}ngAfterViewInit(){this.init()}ngOnDestroy(){this._chart?.dispose()}onWindowResize(){this._chart&&this._chart.resize()}get hasData(){return this.localStorage.filter(this.localStorage.allOperations()).length>0}static \u0275fac=function(t){return new(t||s)(o(S),o(c),o(g),o(T),o(M))};static \u0275cmp=y({type:s,selectors:[["my-chart-dataset"]],hostBindings:function(t,r){t&1&&w("resize",function(){return r.onWindowResize()},D)},features:[I([c])],decls:3,vars:3,consts:[[1,"position-relative","w-100","d-flex","justify-content-around","h-100"],["id","chart-container",2,"width","70rem","max-width","100vw"],[1,"position-absolute","top-0","left-0","w-100","h-100","z-3","d-flex","justify-content-center","align-items-center"]],template:function(t,r){t&1&&(d(0,"div",0),C(1,"div",1),b(2,j,2,0,"div",2),p()),t&2&&(m(),x("opacity-50",!r.hasData),m(),_(r.hasData?-1:2))},encapsulation:2})};export{P as ChartDataset};
