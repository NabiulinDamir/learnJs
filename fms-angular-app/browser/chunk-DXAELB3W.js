import{a as j}from"./chunk-ATW53B2S.js";import{Lb as c,Oa as _,Pa as w,Qb as k,Rb as P,Sb as S,Ya as h,Za as f,_a as x,bb as C,da as g,ha as D,kb as I,lb as E,oa as y,pa as p,rb as M,ua as o,ya as b,yb as T,zb as O}from"./chunk-XUERIW3B.js";function V(s,e){s&1&&(h(0,"div",2),E(1," \u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 "),f())}var H=class s{constructor(e,a,r,i,l){this.localStorage=e;this.datePipe=a;this.element=r;this.filter=i;this.theme=l;O(()=>{if(!this._isVisible())return;let m=document.getElementById("chart-container");m?.removeAttribute("_echarts_instance_"),this._chart=j(m,l.darkTheme()?"dark":""),this._chart.setOption(this.option()),this._chart.off("click"),this._chart.on("click",t=>{this.clickToChart(t)})})}_chart=void 0;observer;_isVisible=g(!1);option=T(()=>{let e=this.format(this.localStorage.filterOperations());return{backgroundColor:"transparent",tooltip:{trigger:"axis"},legend:{data:["\u0414\u043E\u0445\u043E\u0434\u044B","\u0420\u0430\u0441\u0445\u043E\u0434\u044B"],itemGap:5},title:{text:`\u041E\u043F\u0435\u0440\u0430\u0446\u0438\u0438 \u0437\u0430 ${this.filter.intervalLocale}`,position:"top"},dataset:{source:e},grid:{top:"12%",left:"1%",right:"10%",containLabel:!0},xAxis:{type:"category"},yAxis:{type:"value",name:"\u0421\u0443\u043C\u043C\u0430"},dataZoom:[{show:!0,start:0,end:100}],series:[{name:"\u0414\u043E\u0445\u043E\u0434\u044B",type:"bar",color:"#0d6efd"},{name:"\u0420\u0430\u0441\u0445\u043E\u0434\u044B",type:"bar",color:"#6c757d"}]}});format(e){let a=e.sort((t,n)=>t.date.getTime()-n.date.getTime()),r=new Map,i=new Date(this.filter.startInterval),l=new Date(this.filter.endInterval);do{let t=this.formatDate(i);r.set(t,{name:t,income:0,expens:0}),this.filter.interval()==="day"?i.setHours(i.getHours()+1):this.filter.interval()==="month"?i.setDate(i.getDate()+1):this.filter.interval()==="year"?i.setMonth(i.getMonth()+1):i.setDate(i.getDate()+1)}while(i<=l);for(let t of a){let n=this.formatDate(t.date),d=r.get(n),u=t.type==="income"?t.value:0,v=t.type==="expens"?t.value:0;d?r.set(n,{name:n,income:d.income+u,expens:d.expens+v,date:t.date}):r.set(n,{name:n,income:u,expens:v,date:t.date})}return Array.from(r.values())}clickToChart(e){e.componentType==="series"&&(this.filter.downInterval(),setTimeout(()=>this.filter.setDate(e.data.date),100))}formatDate(e){let a=()=>{switch(this.filter.interval()){case"day":return"H";case"month":return"d";case"year":return"MMMM";default:return"dd.MM.yyyy"}};return this.datePipe.transform(e,a())}ngAfterViewInit(){this.observer=new IntersectionObserver(([e])=>{this._isVisible.set(e.isIntersecting)}),this.observer.observe(this.element.nativeElement)}ngOnDestroy(){this._chart?.dispose(),this.observer?.disconnect()}onWindowResize(){this._chart&&this._chart.resize()}get hasData(){return this.localStorage.filterOperations().length>0}static \u0275fac=function(a){return new(a||s)(o(P),o(c),o(D),o(k),o(S))};static \u0275cmp=b({type:s,selectors:[["my-chart-dataset"]],hostBindings:function(a,r){a&1&&C("resize",function(){return r.onWindowResize()},y)},features:[M([c])],decls:3,vars:3,consts:[[1,"position-relative","w-100","d-flex","justify-content-around"],["id","chart-container",2,"width","70rem","height","350px","max-width","100vw"],[1,"position-absolute","top-0","left-0","w-100","h-100","z-3","d-flex","justify-content-center","align-items-center"]],template:function(a,r){a&1&&(h(0,"div",0),x(1,"div",1),_(2,V,2,0,"div",2),f()),a&2&&(p(),I("opacity-50",!r.hasData),p(),w(r.hasData?-1:2))},encapsulation:2})};export{H as ChartDataset};
