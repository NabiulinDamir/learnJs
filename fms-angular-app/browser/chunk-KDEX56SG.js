import{a as p}from"./chunk-ATW53B2S.js";import{Lb as d,Oa as _,Pa as y,Qb as I,Rb as O,Sb as T,Ya as m,Za as h,_a as w,bb as b,da as f,ha as v,kb as l,lb as D,oa as g,pa as c,rb as x,ua as o,ya as C,zb as E}from"./chunk-XUERIW3B.js";function M(a,t){a&1&&(m(0,"div",3),D(1," \u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 "),h())}var R=class a{constructor(t,e,r,n,i){this.localStorage=t;this.datePipe=e;this.element=r;this.filter=n;E(()=>{if(!this._isVisible())return;let s=document.getElementById("my-chart-rounded-income"),u=document.getElementById("my-chart-rounded-expens");s?.removeAttribute("_echarts_instance_"),u?.removeAttribute("_echarts_instance_"),this._incomeChart=p(s,i.darkTheme()?"dark":""),this._expensChart=p(u,i.darkTheme()?"dark":""),this._incomeChart.setOption(this.getOption("income")),this._expensChart.setOption(this.getOption("expens"))})}_incomeChart=void 0;_expensChart=void 0;observer;_isVisible=f(!1);getOption(t){let e=this.localStorage.getOperationsByType(t),r=this.format(e);return{backgroundColor:"transparent",tooltip:{trigger:"item"},title:{text:`${t==="income"?"\u0414\u043E\u0445\u043E\u0434\u044B":"\u0420\u0430\u0441\u0445\u043E\u0434\u044B"}: ${e.reduce((n,i)=>n+=i.value,0)} \u0440\u0443\u0431.`,position:"top"},series:[{name:"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F",type:"pie",radius:["40%","70%"],data:r,top:"10%",label:{show:!0,position:"outside"},color:["#0d6efd","#0a58ca","#3d8bfd","#6ea8fe","#9fcdff","#084298","#052c65"]}]}}format(t){let e=new Map;return t.forEach(n=>{let i=n.category;e.has(i)||e.set(i,{name:i,value:0});let s=e.get(i).value;e.set(i,{name:i,value:s+n.value})}),Array.from(e.values())}formatDate(t){let e=()=>{switch(this.filter.interval()){case"day":return"H";case"month":return"d";case"year":return"MMMM";default:return"dd.MM.yyyy"}};return this.datePipe.transform(t,e())}ngAfterViewInit(){this.observer=new IntersectionObserver(([t])=>{this._isVisible.set(t.isIntersecting)}),this.observer.observe(this.element.nativeElement)}ngOnDestroy(){this._incomeChart?.dispose(),this._expensChart?.dispose(),this.observer?.disconnect()}onWindowResize(){this._incomeChart&&this._incomeChart.resize(),this._expensChart&&this._expensChart.resize()}get hasData(){return this.localStorage.filterOperations().length>0}static \u0275fac=function(e){return new(e||a)(o(O),o(d),o(v),o(I),o(T))};static \u0275cmp=C({type:a,selectors:[["my-chart-two-rounded"]],hostBindings:function(e,r){e&1&&b("resize",function(){return r.onWindowResize()},g)},features:[x([d])],decls:4,vars:5,consts:[[1,"position-relative","w-100","d-flex","justify-content-around"],["id","my-chart-rounded-income",2,"width","30rem","height","350px","max-width","40vw"],["id","my-chart-rounded-expens",2,"width","30rem","height","350px","max-width","40vw"],[1,"position-absolute","top-0","left-0","w-100","h-100","z-3","d-flex","justify-content-center","align-items-center"]],template:function(e,r){e&1&&(m(0,"div",0),w(1,"div",1)(2,"div",2),_(3,M,2,0,"div",3),h()),e&2&&(c(),l("opacity-50",!r.hasData),c(),l("opacity-50",!r.hasData),c(),y(r.hasData?-1:3))},encapsulation:2})};export{R as ChartTwoRounded};
