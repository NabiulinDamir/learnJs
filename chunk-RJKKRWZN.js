import{a as k}from"./chunk-3LNOJY4C.js";import{$a as d,Aa as g,Ob as l,Qa as y,Ra as D,Ub as T,Vb as b,Wb as S,_a as h,ab as w,cb as _,kb as C,lb as x,qa as v,ra as c,rb as O,wa as r,zb as m}from"./chunk-VHW5RPT7.js";function E(s,e){s&1&&(h(0,"div",2),x(1," \u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 "),d())}var I=class s{constructor(e,t,i,a){this.localStorage=e;this.datePipe=t;this.filter=i;this.theme=a;m(()=>{this.updateOption(),this.setOption()}),m(()=>{this.init(),this.setOption()})}_chart=void 0;_option=void 0;init(){let e=this.theme.darkTheme()?"dark":"",t=document.getElementById("chart-negative-container");this._chart?.dispose(),t?.clientHeight&&(this._chart=k(t,e),this._chart.off("click"),this._chart.on("click",i=>{this.clickToChart(i)}))}setOption(){this._chart?.setOption(this._option)}updateOption(){let e=this.format(this.localStorage.filter(this.localStorage.allOperations()));this._option={backgroundColor:"transparent",tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},title:{text:`\u041E\u0440\u0435\u0440\u0430\u0446\u0438\u0438 \u0437\u0430 ${this.filter.intervalLocale}`,position:"top"},grid:{top:80,bottom:30},yAxis:{type:"value",position:"top",splitLine:{lineStyle:{type:"dashed"}}},xAxis:{data:e.map(t=>t.name),type:"category",axisLine:{show:!1},axisLabel:{},axisTick:{show:!1},splitLine:{show:!1}},series:[{markLine:{data:[{yAxis:0,lineStyle:{color:"#0d6efd",width:2},label:{show:!1}}]},name:"\u0418\u0442\u043E\u0433\u043E",type:"bar",stack:"Total",label:{show:!0,formatter:"{c}"},itemStyle:{color:t=>t.value>0?"#28a745":t.value<0?"#dc3545":"#000000"},data:e}]}}format(e){let t=e.sort((o,n)=>o.date.getTime()-n.date.getTime()),i=new Map,a=new Date(this.filter.startInterval),M=new Date(this.filter.endInterval);do{let o=this.formatDate(a);i.set(o,{name:o,value:0,date:a}),this.filter.interval()==="day"?a.setHours(a.getHours()+1):this.filter.interval()==="month"?a.setDate(a.getDate()+1):this.filter.interval()==="year"?a.setMonth(a.getMonth()+1):a.setDate(a.getDate()+1)}while(a<=M);for(let o of t){let n=this.formatDate(o.date),p=i.get(n),f=o.type==="income"?o.value:0,u=o.type==="expens"?-o.value:0;p?i.set(n,{name:n,value:p.value+f+u,date:o.date}):i.set(n,{name:n,value:f+u,date:o.date})}return Array.from(i.values())}clickToChart(e){e.componentType==="series"&&(this.filter.downInterval(),setTimeout(()=>this.filter.setDate(e.data.date),100))}formatDate(e){let t=()=>{switch(this.filter.interval()){case"day":return"H";case"month":return"dd";case"year":return"MMMM";default:return"dd.MM.yyyy"}};return this.datePipe.transform(e,t())}ngAfterViewInit(){}ngOnDestroy(){this._chart?.dispose()}onWindowResize(){this._chart&&this._chart.resize()}get hasData(){return this.localStorage.filter(this.localStorage.allOperations()).length>0}static \u0275fac=function(t){return new(t||s)(r(S),r(l),r(b),r(T))};static \u0275cmp=g({type:s,selectors:[["my-chart-negative"]],hostBindings:function(t,i){t&1&&_("resize",function(){return i.onWindowResize()},v)},features:[O([l])],decls:3,vars:3,consts:[[1,"position-relative","w-100","d-flex","justify-content-around","h-100"],["id","chart-negative-container",2,"width","70rem","max-width","100vw"],[1,"position-absolute","top-0","left-0","w-100","h-100","z-3","d-flex","justify-content-center","align-items-center"]],template:function(t,i){t&1&&(h(0,"div",0),w(1,"div",1),y(2,E,2,0,"div",2),d()),t&2&&(c(),C("opacity-50",!i.hasData),c(),D(i.hasData?-1:2))},encapsulation:2})};export{I as ChartWithNegative};
