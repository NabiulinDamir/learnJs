import{a as L}from"./chunk-TW442VVN.js";import{Lb as l,Oa as w,Pa as _,Qb as N,Rb as O,Sb as S,Ya as h,Za as p,_a as x,bb as C,da as g,ha as y,kb as I,lb as E,oa as D,pa as d,rb as M,ua as o,ya as b,yb as T,zb as k}from"./chunk-O5FJIDC6.js";function P(s,e){s&1&&(h(0,"div",2),E(1," \u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 "),p())}var W=class s{constructor(e,t,r,a,c){this.localStorage=e;this.datePipe=t;this.element=r;this.filter=a;k(()=>{if(!this._isVisible())return;let m=document.getElementById("chart-negative-container");m?.removeAttribute("_echarts_instance_"),this._chart=L(m,c.darkTheme()?"dark":""),this._chart.setOption(this.option()),this._chart.off("click"),this._chart.on("click",i=>{this.clickToChart(i)})})}_chart=void 0;observer;_isVisible=g(!1);option=T(()=>{let e=this.format(this.localStorage.filterOperations());return{backgroundColor:"transparent",tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},title:{text:`\u041E\u0440\u0435\u0440\u0430\u0446\u0438\u0438 \u0437\u0430 ${this.filter.intervalLocale}`,position:"top"},grid:{top:80,bottom:30},yAxis:{type:"value",position:"top",splitLine:{lineStyle:{type:"dashed"}}},xAxis:{data:e.map(t=>t.name),type:"category",axisLine:{show:!1},axisLabel:{},axisTick:{show:!1},splitLine:{show:!1}},series:[{markLine:{data:[{yAxis:0,lineStyle:{color:"#0d6efd",width:2},label:{show:!1}}]},name:"\u0418\u0442\u043E\u0433\u043E",type:"bar",stack:"Total",label:{show:!0,formatter:"{c}"},itemStyle:{color:t=>t.value>0?"#28a745":t.value<0?"#dc3545":"#000000"},data:e}]}});format(e){let t=e.sort((i,n)=>i.date.getTime()-n.date.getTime()),r=new Map,a=new Date(this.filter.startInterval),c=new Date(this.filter.endInterval);do{let i=this.formatDate(a);r.set(i,{name:i,value:0,date:a}),this.filter.interval()==="day"?a.setHours(a.getHours()+1):this.filter.interval()==="month"?a.setDate(a.getDate()+1):this.filter.interval()==="year"?a.setMonth(a.getMonth()+1):a.setDate(a.getDate()+1)}while(a<=c);for(let i of t){let n=this.formatDate(i.date),f=r.get(n),u=i.type==="income"?i.value:0,v=i.type==="expens"?-i.value:0;f?r.set(n,{name:n,value:f.value+u+v,date:i.date}):r.set(n,{name:n,value:u+v,date:i.date})}return Array.from(r.values())}clickToChart(e){e.componentType==="series"&&(this.filter.downInterval(),setTimeout(()=>this.filter.setDate(e.data.date),100))}formatDate(e){let t=()=>{switch(this.filter.interval()){case"day":return"H";case"month":return"dd";case"year":return"MMMM";default:return"dd.MM.yyyy"}};return this.datePipe.transform(e,t())}ngAfterViewInit(){this.observer=new IntersectionObserver(([e])=>{this._isVisible.set(e.isIntersecting)}),this.observer.observe(this.element.nativeElement)}ngOnDestroy(){this._chart?.dispose(),this.observer?.disconnect()}onWindowResize(){this._chart&&this._chart.resize()}get hasData(){return this.localStorage.filterOperations().length>0}static \u0275fac=function(t){return new(t||s)(o(O),o(l),o(y),o(N),o(S))};static \u0275cmp=b({type:s,selectors:[["my-chart-negative"]],hostBindings:function(t,r){t&1&&C("resize",function(){return r.onWindowResize()},D)},features:[M([l])],decls:3,vars:3,consts:[[1,"position-relative","w-100","d-flex","justify-content-around"],["id","chart-negative-container",2,"width","70rem","height","350px","max-width","100vw"],[1,"position-absolute","top-0","left-0","w-100","h-100","z-3","d-flex","justify-content-center","align-items-center"]],template:function(t,r){t&1&&(h(0,"div",0),x(1,"div",1),w(2,P,2,0,"div",2),p()),t&2&&(d(),I("opacity-50",!r.hasData),d(),_(r.hasData?-1:2))},encapsulation:2})};export{W as ChartWithNegative};
