import{a as T}from"./chunk-LGPRC7FN.js";import{$a as _,Aa as g,Nb as c,Pa as v,Qa as y,Tb as b,Ub as I,Vb as M,Za as m,_a as h,bb as C,kb as w,lb as x,qa as D,ra as d,rb as O,wa as r,zb as p}from"./chunk-IWCGAY6K.js";function k(s,e){s&1&&(m(0,"div",2),x(1," \u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445 "),h())}var E=class s{constructor(e,t,i,a){this.localStorage=e;this.datePipe=t;this.filter=i;this.theme=a;p(()=>{this.updateOption(),this.setOption()}),p(()=>{this.init(),this.setOption()})}_chart=void 0;_option=void 0;setOption(){this._option&&this._chart?.setOption(this._option)}init(){let e=this.theme.darkTheme()?"dark":"",t=document.getElementById("chart-container");t?.clientHeight&&(this._chart?.dispose(),this._chart=T(t,e),this._chart.off("click"),this._chart.on("click",i=>{this.clickToChart(i)}))}updateOption(){let e=this.localStorage.filter(this.localStorage.allOperations()),t=this.format(e);this._option={backgroundColor:"transparent",tooltip:{trigger:"axis"},legend:{data:["\u0414\u043E\u0445\u043E\u0434\u044B","\u0420\u0430\u0441\u0445\u043E\u0434\u044B"],itemGap:5},title:{text:`\u041E\u043F\u0435\u0440\u0430\u0446\u0438\u0438 \u0437\u0430 ${this.filter.intervalLocale}`,position:"top"},dataset:{source:t},grid:{top:"12%",left:"1%",right:"10%",containLabel:!0},xAxis:{type:"category"},yAxis:{type:"value",name:"\u0421\u0443\u043C\u043C\u0430"},dataZoom:[{show:!0,start:0,end:100}],series:[{name:"\u0414\u043E\u0445\u043E\u0434\u044B",type:"bar",color:"#0d6efd"},{name:"\u0420\u0430\u0441\u0445\u043E\u0434\u044B",type:"bar",color:"#6c757d"}]}}format(e){let t=e.sort((n,o)=>n.date.getTime()-o.date.getTime()),i=new Map,a=new Date(this.filter.startInterval),S=new Date(this.filter.endInterval);do{let n=this.formatDate(a);i.set(n,{name:n,income:0,expens:0}),this.filter.interval()==="day"?a.setHours(a.getHours()+1):this.filter.interval()==="month"?a.setDate(a.getDate()+1):this.filter.interval()==="year"?a.setMonth(a.getMonth()+1):a.setDate(a.getDate()+1)}while(a<=S);for(let n of t){let o=this.formatDate(n.date),l=i.get(o),f=n.type==="income"?n.value:0,u=n.type==="expens"?n.value:0;l?i.set(o,{name:o,income:l.income+f,expens:l.expens+u,date:n.date}):i.set(o,{name:o,income:f,expens:u,date:n.date})}return Array.from(i.values())}clickToChart(e){e.componentType==="series"&&(this.filter.downInterval(),setTimeout(()=>this.filter.setDate(e.data.date),100))}formatDate(e){let t=()=>{switch(this.filter.interval()){case"day":return"H";case"month":return"d";case"year":return"MMMM";default:return"dd.MM.yyyy"}};return this.datePipe.transform(e,t())}ngAfterViewInit(){this.init(),this.setOption()}ngOnDestroy(){this._chart?.dispose()}onWindowResize(){this._chart&&this._chart.resize()}get hasData(){return this.localStorage.filter(this.localStorage.allOperations()).length>0}static \u0275fac=function(t){return new(t||s)(r(M),r(c),r(I),r(b))};static \u0275cmp=g({type:s,selectors:[["my-chart-dataset"]],hostBindings:function(t,i){t&1&&C("resize",function(){return i.onWindowResize()},D)},features:[O([c])],decls:3,vars:3,consts:[[1,"position-relative","w-100","d-flex","justify-content-around","h-100"],["id","chart-container",2,"width","70rem","max-width","100vw"],[1,"position-absolute","top-0","left-0","w-100","h-100","z-3","d-flex","justify-content-center","align-items-center"]],template:function(t,i){t&1&&(m(0,"div",0),_(1,"div",1),v(2,k,2,0,"div",2),h()),t&2&&(d(),w("opacity-50",!i.hasData),d(),y(i.hasData?-1:2))},encapsulation:2})};export{E as ChartDataset};
